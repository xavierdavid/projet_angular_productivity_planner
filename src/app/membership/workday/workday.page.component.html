<!DOCTYPE html>
<div class="container my-5">
  <pre>{{ workday().taskList | json }}</pre>
  <!-- Header avec date centrée et bouton à droite -->
  <div class="row align-items-center mb-4">
    <div class="col-md-4"></div>
    <div class="col-md-4 text-center">
      <h6 class="mb-2">Working Day</h6>
      <!-- Sélection de la date - Ecoute de l'évènement 'change'-->
      <input type="date" class="form-control" [value]="workday().date" (change)="updateDate($event)" [disabled]="workday().isExecutionMode || workday().isWorkdayCompleted"/>
      <!-- Affichage de la barre de progression lorsque l'on passe en mode 'execution'-->
      @if(workday().isExecutionMode) {
        <div class="d-flex flex-column align-items mt-2">
          <div class="progress w-100" data-testid="workday-progress">
          <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" role="progressbar"
            [style.width.%]="pomodoroProgress()" [attr.aria-valuenow]="pomodoroProgress()" aria-valuemin="0"
            aria-valuemax="100">
            {{ pomodoroProgress() }}%
            </div>
          </div>
          <p class="text-muted small mt-2 text-center w-100">{{ progress() }} seconds have passed.</p>
        </div>
      }
    </div>
  <!-- Si une tâche est planifiée ou si on est en mode 'edit' -->
  @if(workday().hasTaskPlanned && workday().isEditMode && !workday().isWorkdayCompleted) {
    <div class="col-md-4 text-end mt-3 mt-md-0">
      <button class="btn btn-success rounded-pill px-4 py-2 fw-bold" (click)="startWorkday()">
        Start the work day
      </button>
    </div>
  }
  </div>

  <!-- Si aucune tâche n'est planifiée -->
  @if(workday().hasNoTaskPlanned && workday().isEditMode) {
  <div class="text-center my-5" data-testid="inbox-zero-placeholder">
    <!-- Image et texte à afficher -->
    <img src="images/productivity-planner-inbox-zero.gif" alt="Inbox zero" class="img-fluid mx-auto" />
    <p class="mt-3 text-muted">Aucune tâche prévue pour aujourd'hui !</p>
  </div>
  }

  <!-- Boucle sur les tâches à afficher -->
  @for(task of workday().taskList; track $index) {
    <!--Titre de la tâche -->
    @if($index === 0) {
      <h6 class="mb-3 text-muted">Most important task</h6>
    }
    @if($index === 1) {
      <h6 class="mb-3 text-muted">Tâches de seconde importance</h6>
    }
    @if($index === 3) {
      <h6 class="mb-3 text-muted">Tâches restantes</h6>
    }

    <!-- Affichage du composant Task-->
    @if(workday().isEditMode && !workday().isWorkdayCompleted && !workday().isTaskCompleted(task)) {
      <app-task-field class="p-3 mb-3" [task]="task" [index]="$index" (taskUpdated)="updateTask($index, $event)" (taskRemoved)="removeTask($index)" />
    }
    @if(workday().isExecutionMode || workday().isWorkdayCompleted || workday().isTaskCompleted(task)) {
      <app-task-readonly [task]="task" [index]="$index"/>
    }
  }

  <!-- Ajouter une tâche -->
  <div class="text-center">
    @if(workday().canAddTask) {
    <button data-testid="add-task-button" class="btn btn-link text-muted" (click)="addTask()">Ajouter une tâche</button>
    }
  </div>
</div>
